<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>技术方案 on 我的AI辅助博客</title>
    <link>//localhost:1313/categories/%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/</link>
    <description>Recent content in 技术方案 on 我的AI辅助博客</description>
    <generator>Hugo -- 0.152.2</generator>
    <language>zh-cn</language>
    <lastBuildDate>Thu, 13 Nov 2025 17:00:00 +0800</lastBuildDate>
    <atom:link href="//localhost:1313/categories/%E6%8A%80%E6%9C%AF%E6%96%B9%E6%A1%88/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>智能分流网关分流部署方案(ipset、wireguard、dnsmasq)</title>
      <link>//localhost:1313/posts/%E5%AE%8C%E6%95%B4%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88%E5%9F%BA%E4%BA%8Ewireguard%E7%9A%84%E5%9B%BD%E5%86%85%E5%88%B0%E5%9B%BD%E5%A4%96vps%E7%BB%84%E7%BD%91%E6%9E%B6%E6%9E%84-%E6%9C%80%E7%BB%88%E4%BF%AE%E6%AD%A3%E7%89%88/</link>
      <pubDate>Thu, 13 Nov 2025 17:00:00 +0800</pubDate>
      <guid>//localhost:1313/posts/%E5%AE%8C%E6%95%B4%E9%83%A8%E7%BD%B2%E6%96%B9%E6%A1%88%E5%9F%BA%E4%BA%8Ewireguard%E7%9A%84%E5%9B%BD%E5%86%85%E5%88%B0%E5%9B%BD%E5%A4%96vps%E7%BB%84%E7%BD%91%E6%9E%B6%E6%9E%84-%E6%9C%80%E7%BB%88%E4%BF%AE%E6%AD%A3%E7%89%88/</guid>
      <description>&lt;h1 id=&#34;这是你的文章正文内容从这里开始&#34;&gt;这是你的文章正文内容，从这里开始&amp;hellip;&lt;/h1&gt;
&lt;h2 id=&#34;概述与技术栈建议&#34;&gt;概述与技术栈建议&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;需求实现&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;DNS分流 (黑名单模式)&lt;/strong&gt;：被墙域名通过&lt;code&gt;8.8.8.8&lt;/code&gt;走WireGuard隧道解析；国内及所有未匹配的域名，默认通过&lt;code&gt;114.114.114.114&lt;/code&gt;直连解析。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;流量分流 (黑名单模式)&lt;/strong&gt;：目标IP在大陆IP列表中的流量直连；目标IP在被墙IP列表中的流量走隧道；所有未匹配的流量默认直连。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;安全增强&lt;/strong&gt;：集成Kill Switch，当隧道意外断开时，自动阻止所有应走隧道的流量，防止真实IP泄露。&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;自动化与持久化&lt;/strong&gt;：所有路由和防火墙规则与WireGuard接口生命周期绑定，实现开机自启、自动配置与清理，无需手动干预。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;技术栈&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;WireGuard：VPN隧道（UDP，端口51820）。&lt;/li&gt;
&lt;li&gt;Dnsmasq：本地DNS服务器，分流解析。&lt;/li&gt;
&lt;li&gt;ipset + iptables + ip rule/route：政策路由分流。&lt;/li&gt;
&lt;li&gt;gfwlist2dnsmasq.sh：生成被墙域名黑名单。&lt;/li&gt;
&lt;li&gt;cron + bash：自动化更新。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;注意事项&lt;/strong&gt;：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;先在测试环境试运行，避免影响生产。&lt;/li&gt;
&lt;li&gt;VPS防火墙需允许WireGuard端口：&lt;code&gt;ufw allow 51820/udp&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;VPS启用IP转发：&lt;code&gt;echo &#39;net.ipv4.ip_forward=1&#39; &amp;gt;&amp;gt; /etc/sysctl.conf; sysctl -p&lt;/code&gt;。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;步骤1-安装必要工具&#34;&gt;步骤1: 安装必要工具&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;VPS (服务器端)&lt;/strong&gt;：
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt update  # 更新软件包列表
sudo apt install wireguard -y # 仅需安装WireGuard
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;国内客户端&lt;/strong&gt;：
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt update  # 更新软件包列表
# iptables-persistent不再需要，因为规则由WireGuard动态管理
sudo apt install wireguard dnsmasq ipset cron -y
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;下载gfwlist2dnsmasq.sh&lt;/strong&gt;（客户端）：
&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;wget https://github.com/cokebar/gfwlist2dnsmasq/raw/master/gfwlist2dnsmasq.sh -O /usr/local/bin/gfwlist2dnsmasq.sh
chmod +x /usr/local/bin/gfwlist2dnsmasq.sh
&lt;/code&gt;&lt;/pre&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&#34;步骤2-配置wireguard隧道&#34;&gt;步骤2: 配置WireGuard隧道&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;&lt;strong&gt;生成密钥&lt;/strong&gt;（在VPS和客户端上分别执行）：&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
